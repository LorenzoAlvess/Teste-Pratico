<!-- graficos.html -->
{% extends 'pages/base.html' %}

{% block title %}
    Gráficos
{% endblock %}

{% block content %}
    <div class="main">
        <div class="container-fluid">
            <div class="row">
                <div class="col-md-8">
                    <div class="chart-container" style="height: 300px;">
                        <canvas id="booksPerMonthChart" style="width: 100%; height: 100%;"></canvas>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="chart-container" style="height: 300px;">
                        <canvas id="booksPerLibraryChart" style="width: 100%; height: 100%;"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
        <script>
            document.addEventListener('DOMContentLoaded', function() {
                // Configurar o gráfico de livros cadastrados por mês
                var booksPerMonthCtx = document.getElementById('booksPerMonthChart').getContext('2d');
                var booksPerMonthChart = new Chart(booksPerMonthCtx, {
                    type: 'bar',
                    data: {
                        labels: [{% for i in books_per_month|slice:"6" %}"{{ i.month }}"{% if not forloop.last %},{% endif %}{% endfor %}],
                        datasets: [{
                            label: 'Livros Cadastrados por Mês',
                            data: [{% for i in books_per_month|slice:"6" %}{{ i.count }}{% if not forloop.last %},{% endif %}{% endfor %}],
                            backgroundColor: 'rgba(75, 192, 192, 0.2)',
                            borderColor: 'rgba(75, 192, 192, 1)',
                            borderWidth: 1
                        }]
                    },
                    options: {
                        scales: {
                            yAxes: [{
                                ticks: {
                                    beginAtZero: true
                                }
                            }]
                        }
                    }
                });

                // Configurar o gráfico de quantidade total de livros por biblioteca
                var booksPerLibraryCtx = document.getElementById('booksPerLibraryChart').getContext('2d');
                var booksPerLibraryChart = new Chart(booksPerLibraryCtx, {
                    type: 'bar',
                    data: {
                        labels: [{% for library in libraries %}"{{ library.name }}"{% if not forloop.last %},{% endif %}{% endfor %}],
                        datasets: [{
                            label: 'Quantidade Total de Livros por Biblioteca',
                            data: [{% for library in libraries %}{{ library.num_books }}{% if not forloop.last %},{% endif %}{% endfor %}],
                            backgroundColor: 'rgba(255, 99, 132, 0.2)',
                            borderColor: 'rgba(255, 99, 132, 1)',
                            borderWidth: 1
                        }]
                    },
                    options: {
                        scales: {
                            yAxes: [{
                                ticks: {
                                    beginAtZero: true
                                }
                            }]
                        }
                    }
                });
            });
        </script>
    </div>
{% endblock %}
